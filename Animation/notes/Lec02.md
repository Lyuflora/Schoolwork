# 计算机动画
Lec 2
# 形状插值
## 形状线性插值
执行速度快，可能失真。<br>
**数据对应**：点一一对应，对于人造数据可以做到<br>
设两个图形上各有N个点，要生成10个中间画面图形，将每一组对应的点作为线性插值的起始和终结点，取时间变量t的10个等分的值(0:0.1:1)，合成10个插值位置。对图形上N个点如此操作。经过两个for循环：

	for(t=0;t<1,t=t+0.1 )
		for(i =0; N i ++)
			Xin(i) = (1-t)*x0(i)+t* x(i);
			Yin(i) = (1-t)*y0(i)+t* y(i);
		} 
插值部分框架：	
>

	For (IMAGE=1 to NBFRAMES) { // 对中间画面循环
	   t=IMAGE/NBFRAMES; (插值变量t )
	
	   VAL=LAW(OP, t);
	        xin=(1-VAL)*x0+VAL*x1 ，
	        yin=(1-VAL)*y0+VAL*y1 ，
	   Draw intermediate shapes;
	}


   其中OP为调用4种速度的参数: 

        1. 等速:  law=t;
        2. 加速:  law=(1-cos(PI*t/2));
        3. 减速:  law=sin(PI*t/2);
<br>

## 移动点限制法
指定一组关键帧，在对应的时刻上对物体形状加以控制。
指定一组附加的`移动点`（MP1, MP2, ...MPQ），确定运动物体的轨迹和动态。 

指定移动点和关键帧后的`碎片网格`可能是不完整的。
### 碎片
>
对于网格中的一个碎片内一点(x,y)由方程 **x=X(u,t), y=Y(u,t)** 来定义，u是空间变量，t是时间变量.<br>
>现在碎片可以写成<br>
        **(x,y)=P(u,t)=[X(u,t)Y(u,t)],   0<=u<=1, 0<=t<=1**.
   
这里矢量P(0,t), P(1,t), P(u,0) 和P(u,1)是有一个自由度的点轨迹（即曲线），这样碎片是定义在u-t平面上的矩形。

对于一小块加以限制的“碎片”，它受到的限制在时间和空间两个维度。<br>
![](https://i.imgur.com/u2DG9z4.png)

### 一个“碎片”内部的插值
算出矢量，在时间上，算出中间曲线`在u0~ut,0t~1t`之间的**Hermite曲线**。


## 线性矢量插值法
把初始和终止图形曲线分解成N-1个矢量（N为曲线上点的数量；
计算各个矢量的极坐标 r0(i),θ0(i), r1(i), θ1(i)；

	用下列方程进行插值运算                               
     for(t=0;t<1,t=t+0.1)
	{
         for(i =0;i<N; i++)
		{                           
               rin(i)=(1-t)*r0(i)+t*r1(i), 
                in(i)=(1-t)*0(i)+t*1(i),
	     }
	}


![](https://i.imgur.com/cBOmKQu.jpg)

分解成许多矢量的集合，同一矢量的变化过程用线性插值。



## 利用多分辨率变形

![数学表达](https://i.imgur.com/eT6hkno.jpg)

右侧分别是封闭的参数曲线，曲率函数，和在时间τ的法向矢量函数。

## 利用unions of circles (U0C)变形

## 骨架法

骨架是一种线形图(stick figure)，只由少数的点组成，并利用它表现物体述的运动姿态。
优点：动画师只需控制骨架构成的关键图，计算机通过这些关键图生成较好的骨架中间图。图形的细部用计算机根据简单的模型加到骨架上(蒙皮,skinning)。

![](https://i.imgur.com/7eFjWW3.jpg)

采用四边形的网络，其相对坐标与每个顶点联
系起来，从一个顶点到下一个顶点沿某个方向
向前进就对应于一个单元的变化，如图所示。

![](https://i.imgur.com/vJBhRuD.png)

### 插值与蒙皮
>指定两个`关键帧`上的粉色骨架
><br>
>对两个骨架进行 **线性插值** 得到中间运动骨架
><br>
>在每个中间骨架上计算 **横向“支架”** 位置坐标
><br>
>计算由骨架和横向支架构成的**四边形内部**“纹理”坐标
><br>
>根据`纹理坐标`添加纹理（皮肤）

现有某点P并与四边两个对应边相交，则点P的相对坐标（L和w）计算如下：


	设p1=(x1,y1), p2=(x2,y2), p3=(x3,y3), p4=(x4,y4), p=(x,y), 有

      p’(L)=p1+L*(p2-p1),
      p’’(L)=p3+L*(p4-p3),
      p(w)=p’+w*(p’’-p’)
           L,w∈[0,1]
            w=(p-p’)/(p’’-p’), L=(p’-p1)/(p2-p1)
      由图可知，L ≈0.6，w ≈0.5

![](https://i.imgur.com/A0srlst.jpg)


## 星状骨架(Star-skeleton)方法
Star polygon定义: 对于star polygon 存在一个点, 叫`星点`（star point）, 由该点其它所有点都可见。<br><br>
星状骨架由两部分组成：

1. 把多边形分解成星状部分（star piece），每一部分由其顶点和一个特别的星点——星原点构成<br>
2. 把每个星原点连接得到 一个平面图，即连接各个星原点的骨架
变形算法：先对骨架插值，然后展开各形状部分。
<br>



# 2D变形方法评价准则

## 面积渐变、保持准则
![](https://i.imgur.com/nW1peTb.png)

## 局部有效性
线性插值有效的条件<br>

>1. 方法：用两个关键帧矩形，其中一个相对于另一个旋转不同角度θ（θ~𝜋）， Error(t)=(Sat-St)/St
>![](https://i.imgur.com/aHQZ3EJ.png)
>![](https://i.imgur.com/x5pq5eS.jpg)
2. 对应于误差小于10%的角度是𝜋/6


矢量插值有效的条件<br>
>1. 经过考察发现对应顶点的曲率符号不一致，往往要引起畸变
>2.  甚至对应点符号一致，但其中一个曲率值较大也可以造成畸变。

**根据上述条件计算判断**

1. 计算曲线的曲率
2. 计算两个关键形状的旋转角度θ
3. 如果θ小于𝜋/6，则建议使用线性插值，否则建议使用矢量线性插值。
4. 根据应用情况采用面积保持（在骨架上则用长度保持）准则进行判断。

## Timing（动画时间分配）


# 抽象形状的评价
